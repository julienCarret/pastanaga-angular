import { __decorate, __metadata } from "tslib";
import { Injectable } from '@angular/core';
import { addMonths, addYears, eachDayOfInterval, eachMonthOfInterval, eachYearOfInterval, endOfMonth, endOfWeek, endOfYear, format, isBefore, isFuture, isSameDay, isSameMonth, isSameYear, isSaturday, isSunday, isWithinInterval, startOfMonth, startOfWeek, startOfYear, subMonths, subYears } from 'date-fns';
import { CalendarDate, CalendarView } from './calendar.model';
import * as i0 from "@angular/core";
var CalendarService = /** @class */ (function () {
    function CalendarService() {
    }
    CalendarService.prototype.getNextMonth = function (date, selectedRange, min) {
        var nextDate = addMonths(date, 1);
        return this.getMonth(nextDate, selectedRange, min);
    };
    CalendarService.prototype.getPreviousMonth = function (date, selectedRange, min) {
        var previousDate = subMonths(date, 1);
        return this.getMonth(previousDate, selectedRange, min);
    };
    CalendarService.prototype.getMonth = function (date, selectedRange, min) {
        var start = startOfMonth(date);
        var end = endOfMonth(date);
        var dateRef = start;
        if (!isSunday(start)) {
            start = startOfWeek(start);
        }
        if (!isSaturday(end)) {
            end = endOfWeek(end);
        }
        return {
            dateRef: dateRef,
            dates: eachDayOfInterval({ start: start, end: end }).map(function (d) { return new CalendarDate({
                date: d,
                label: "" + d.getDate(),
                isFuture: isFuture(d),
                firstOfInterval: !!selectedRange.start && isSameDay(d, selectedRange.start),
                lastOfInterval: !!selectedRange.end && isSameDay(d, selectedRange.end),
                inInterval: !!selectedRange.start && !!selectedRange.end
                    && isWithinInterval(d, { start: selectedRange.start, end: selectedRange.end }),
                isActive: (!!selectedRange.start && isSameDay(d, selectedRange.start))
                    || (!!selectedRange.end && isSameDay(d, selectedRange.end)),
                isDisabled: !!min && isBefore(d, min),
            }); }),
            headerButtons: [
                { label: format(date, 'MMMM'), view: CalendarView.month },
                { label: format(date, 'yyyy'), view: CalendarView.year },
            ],
        };
    };
    CalendarService.prototype.getPreviousMonths = function (date, currentDate, min) {
        var previousDate = subYears(date, 1);
        return this.getMonths(previousDate, currentDate, min);
    };
    CalendarService.prototype.getNextMonths = function (date, currentDate, min) {
        var nextDate = addYears(date, 1);
        return this.getMonths(nextDate, currentDate, min);
    };
    CalendarService.prototype.getMonths = function (date, currentDate, min) {
        var start = startOfYear(date);
        var end = endOfYear(date);
        return {
            dateRef: start,
            dates: eachMonthOfInterval({ start: start, end: end }).map(function (d) { return new CalendarDate({
                date: d,
                label: format(d, 'MMMM'),
                isFuture: isFuture(d),
                isActive: isSameMonth(d, currentDate),
                isDisabled: !!min && !isSameMonth(d, min) && isBefore(d, min),
            }); }),
            headerButtons: [{ label: format(date, 'yyyy'), view: CalendarView.year }],
        };
    };
    CalendarService.prototype.getPreviousYears = function (date, currentDate, min) {
        var previousDate = subYears(date, 20);
        return this.getYears(previousDate, currentDate, min);
    };
    CalendarService.prototype.getNextYears = function (date, currentDate, min) {
        var nextDate = addYears(date, 20);
        return this.getYears(nextDate, currentDate, min);
    };
    CalendarService.prototype.getYears = function (date, currentDate, min) {
        var start = subYears(date, 10);
        var end = addYears(date, 9);
        return {
            dateRef: date,
            dates: eachYearOfInterval({ start: start, end: end }).map(function (d) { return new CalendarDate({
                date: d,
                label: "" + d.getFullYear(),
                isFuture: isFuture(d),
                isActive: isSameYear(d, currentDate),
                isDisabled: !!min && !isSameYear(d, min) && isBefore(d, min),
            }); }),
            headerButtons: [{ label: start.getFullYear() + " - " + end.getFullYear(), view: CalendarView.day }],
        };
    };
    CalendarService.ɵprov = i0.ɵɵdefineInjectable({ factory: function CalendarService_Factory() { return new CalendarService(); }, token: CalendarService, providedIn: "root" });
    CalendarService = __decorate([
        Injectable({ providedIn: 'root' }),
        __metadata("design:paramtypes", [])
    ], CalendarService);
    return CalendarService;
}());
export { CalendarService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BndWlsbG90aW5hd2ViL3Bhc3RhbmFnYS1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL2NhbGVuZGFyL2NhbGVuZGFyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUNILFNBQVMsRUFDVCxRQUFRLEVBQ1IsaUJBQWlCLEVBQ2pCLG1CQUFtQixFQUNuQixrQkFBa0IsRUFDbEIsVUFBVSxFQUNWLFNBQVMsRUFDVCxTQUFTLEVBQ1QsTUFBTSxFQUNOLFFBQVEsRUFDUixRQUFRLEVBQ1IsU0FBUyxFQUNULFdBQVcsRUFDWCxVQUFVLEVBQ1YsVUFBVSxFQUNWLFFBQVEsRUFDUixnQkFBZ0IsRUFDaEIsWUFBWSxFQUNaLFdBQVcsRUFDWCxXQUFXLEVBQ1gsU0FBUyxFQUNULFFBQVEsRUFDWCxNQUFNLFVBQVUsQ0FBQztBQUNsQixPQUFPLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBYSxNQUFNLGtCQUFrQixDQUFDOztBQUd6RTtJQUNJO0lBQ0EsQ0FBQztJQUVELHNDQUFZLEdBQVosVUFBYSxJQUFVLEVBQUUsYUFBMkMsRUFBRSxHQUFVO1FBQzVFLElBQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDcEMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxhQUFhLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELDBDQUFnQixHQUFoQixVQUFpQixJQUFVLEVBQUUsYUFBMkMsRUFBRSxHQUFVO1FBQ2hGLElBQU0sWUFBWSxHQUFHLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDeEMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxhQUFhLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFD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O1FBRDNCLFVBQVUsQ0FBQyxFQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUMsQ0FBQzs7T0FDcEIsZUFBZSxDQWdHM0I7MEJBNUhEO0NBNEhDLEFBaEdELElBZ0dDO1NBaEdZLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICAgIGFkZE1vbnRocyxcbiAgICBhZGRZZWFycyxcbiAgICBlYWNoRGF5T2ZJbnRlcnZhbCxcbiAgICBlYWNoTW9udGhPZkludGVydmFsLFxuICAgIGVhY2hZZWFyT2ZJbnRlcnZhbCxcbiAgICBlbmRPZk1vbnRoLFxuICAgIGVuZE9mV2VlayxcbiAgICBlbmRPZlllYXIsXG4gICAgZm9ybWF0LFxuICAgIGlzQmVmb3JlLFxuICAgIGlzRnV0dXJlLFxuICAgIGlzU2FtZURheSxcbiAgICBpc1NhbWVNb250aCxcbiAgICBpc1NhbWVZZWFyLFxuICAgIGlzU2F0dXJkYXksXG4gICAgaXNTdW5kYXksXG4gICAgaXNXaXRoaW5JbnRlcnZhbCxcbiAgICBzdGFydE9mTW9udGgsXG4gICAgc3RhcnRPZldlZWssXG4gICAgc3RhcnRPZlllYXIsXG4gICAgc3ViTW9udGhzLFxuICAgIHN1YlllYXJzXG59IGZyb20gJ2RhdGUtZm5zJztcbmltcG9ydCB7IENhbGVuZGFyRGF0ZSwgQ2FsZW5kYXJWaWV3LCBJQ2FsZW5kYXIgfSBmcm9tICcuL2NhbGVuZGFyLm1vZGVsJztcblxuQEluamVjdGFibGUoe3Byb3ZpZGVkSW46ICdyb290J30pXG5leHBvcnQgY2xhc3MgQ2FsZW5kYXJTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICB9XG5cbiAgICBnZXROZXh0TW9udGgoZGF0ZTogRGF0ZSwgc2VsZWN0ZWRSYW5nZTogeyBzdGFydD86IERhdGUsIGVuZD86IERhdGUgfSwgbWluPzogRGF0ZSk6IElDYWxlbmRhciB7XG4gICAgICAgIGNvbnN0IG5leHREYXRlID0gYWRkTW9udGhzKGRhdGUsIDEpO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNb250aChuZXh0RGF0ZSwgc2VsZWN0ZWRSYW5nZSwgbWluKTtcbiAgICB9XG5cbiAgICBnZXRQcmV2aW91c01vbnRoKGRhdGU6IERhdGUsIHNlbGVjdGVkUmFuZ2U6IHsgc3RhcnQ/OiBEYXRlLCBlbmQ/OiBEYXRlIH0sIG1pbj86IERhdGUpOiBJQ2FsZW5kYXIge1xuICAgICAgICBjb25zdCBwcmV2aW91c0RhdGUgPSBzdWJNb250aHMoZGF0ZSwgMSk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE1vbnRoKHByZXZpb3VzRGF0ZSwgc2VsZWN0ZWRSYW5nZSwgbWluKTtcbiAgICB9XG5cbiAgICBnZXRNb250aChkYXRlOiBEYXRlLCBzZWxlY3RlZFJhbmdlOiB7IHN0YXJ0PzogRGF0ZSwgZW5kPzogRGF0ZSB9LCBtaW4/OiBEYXRlKTogSUNhbGVuZGFyIHtcbiAgICAgICAgbGV0IHN0YXJ0ID0gc3RhcnRPZk1vbnRoKGRhdGUpO1xuICAgICAgICBsZXQgZW5kID0gZW5kT2ZNb250aChkYXRlKTtcbiAgICAgICAgY29uc3QgZGF0ZVJlZiA9IHN0YXJ0O1xuICAgICAgICBpZiAoIWlzU3VuZGF5KHN0YXJ0KSkge1xuICAgICAgICAgICAgc3RhcnQgPSBzdGFydE9mV2VlayhzdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1NhdHVyZGF5KGVuZCkpIHtcbiAgICAgICAgICAgIGVuZCA9IGVuZE9mV2VlayhlbmQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkYXRlUmVmLFxuICAgICAgICAgICAgZGF0ZXM6IGVhY2hEYXlPZkludGVydmFsKHtzdGFydCwgZW5kfSkubWFwKGQgPT4gbmV3IENhbGVuZGFyRGF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0ZTogZCxcbiAgICAgICAgICAgICAgICBsYWJlbDogYCR7ZC5nZXREYXRlKCl9YCxcbiAgICAgICAgICAgICAgICBpc0Z1dHVyZTogaXNGdXR1cmUoZCksXG4gICAgICAgICAgICAgICAgZmlyc3RPZkludGVydmFsOiAhIXNlbGVjdGVkUmFuZ2Uuc3RhcnQgJiYgaXNTYW1lRGF5KGQsIHNlbGVjdGVkUmFuZ2Uuc3RhcnQpLFxuICAgICAgICAgICAgICAgIGxhc3RPZkludGVydmFsOiAhIXNlbGVjdGVkUmFuZ2UuZW5kICYmIGlzU2FtZURheShkLCBzZWxlY3RlZFJhbmdlLmVuZCksXG4gICAgICAgICAgICAgICAgaW5JbnRlcnZhbDogISFzZWxlY3RlZFJhbmdlLnN0YXJ0ICYmICEhc2VsZWN0ZWRSYW5nZS5lbmRcbiAgICAgICAgICAgICAgICAgICAgJiYgaXNXaXRoaW5JbnRlcnZhbChkLCB7c3RhcnQ6IHNlbGVjdGVkUmFuZ2Uuc3RhcnQsIGVuZDogc2VsZWN0ZWRSYW5nZS5lbmR9KSxcbiAgICAgICAgICAgICAgICBpc0FjdGl2ZTogKCEhc2VsZWN0ZWRSYW5nZS5zdGFydCAmJiBpc1NhbWVEYXkoZCwgc2VsZWN0ZWRSYW5nZS5zdGFydCkpXG4gICAgICAgICAgICAgICAgICAgIHx8ICghIXNlbGVjdGVkUmFuZ2UuZW5kICYmIGlzU2FtZURheShkLCBzZWxlY3RlZFJhbmdlLmVuZCkpLFxuICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQ6ICEhbWluICYmIGlzQmVmb3JlKGQsIG1pbiksXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgICBoZWFkZXJCdXR0b25zOiBbXG4gICAgICAgICAgICAgICAge2xhYmVsOiBmb3JtYXQoZGF0ZSwgJ01NTU0nKSwgdmlldzogQ2FsZW5kYXJWaWV3Lm1vbnRofSxcbiAgICAgICAgICAgICAgICB7bGFiZWw6IGZvcm1hdChkYXRlLCAneXl5eScpLCB2aWV3OiBDYWxlbmRhclZpZXcueWVhcn0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGdldFByZXZpb3VzTW9udGhzKGRhdGU6IERhdGUsIGN1cnJlbnREYXRlOiBEYXRlLCBtaW4/OiBEYXRlKTogSUNhbGVuZGFyIHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNEYXRlID0gc3ViWWVhcnMoZGF0ZSwgMSk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE1vbnRocyhwcmV2aW91c0RhdGUsIGN1cnJlbnREYXRlLCBtaW4pO1xuICAgIH1cblxuICAgIGdldE5leHRNb250aHMoZGF0ZTogRGF0ZSwgY3VycmVudERhdGU6IERhdGUsIG1pbj86IERhdGUpOiBJQ2FsZW5kYXIge1xuICAgICAgICBjb25zdCBuZXh0RGF0ZSA9IGFkZFllYXJzKGRhdGUsIDEpO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNb250aHMobmV4dERhdGUsIGN1cnJlbnREYXRlLCBtaW4pO1xuICAgIH1cblxuICAgIGdldE1vbnRocyhkYXRlOiBEYXRlLCBjdXJyZW50RGF0ZTogRGF0ZSwgbWluPzogRGF0ZSk6IElDYWxlbmRhciB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gc3RhcnRPZlllYXIoZGF0ZSk7XG4gICAgICAgIGNvbnN0IGVuZCA9IGVuZE9mWWVhcihkYXRlKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRhdGVSZWY6IHN0YXJ0LFxuICAgICAgICAgICAgZGF0ZXM6IGVhY2hNb250aE9mSW50ZXJ2YWwoe3N0YXJ0LCBlbmR9KS5tYXAoZCA9PiBuZXcgQ2FsZW5kYXJEYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRlOiBkLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBmb3JtYXQoZCwgJ01NTU0nKSxcbiAgICAgICAgICAgICAgICBpc0Z1dHVyZTogaXNGdXR1cmUoZCksXG4gICAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzU2FtZU1vbnRoKGQsIGN1cnJlbnREYXRlKSxcbiAgICAgICAgICAgICAgICBpc0Rpc2FibGVkOiAhIW1pbiAmJiAhaXNTYW1lTW9udGgoZCwgbWluKSAmJiBpc0JlZm9yZShkLCBtaW4pLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgaGVhZGVyQnV0dG9uczogW3tsYWJlbDogZm9ybWF0KGRhdGUsICd5eXl5JyksIHZpZXc6IENhbGVuZGFyVmlldy55ZWFyfV0sXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZ2V0UHJldmlvdXNZZWFycyhkYXRlOiBEYXRlLCBjdXJyZW50RGF0ZTogRGF0ZSwgbWluPzogRGF0ZSk6IElDYWxlbmRhciB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzRGF0ZSA9IHN1YlllYXJzKGRhdGUsIDIwKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0WWVhcnMocHJldmlvdXNEYXRlLCBjdXJyZW50RGF0ZSwgbWluKTtcbiAgICB9XG5cbiAgICBnZXROZXh0WWVhcnMoZGF0ZTogRGF0ZSwgY3VycmVudERhdGU6IERhdGUsIG1pbj86IERhdGUpOiBJQ2FsZW5kYXIge1xuICAgICAgICBjb25zdCBuZXh0RGF0ZSA9IGFkZFllYXJzKGRhdGUsIDIwKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0WWVhcnMobmV4dERhdGUsIGN1cnJlbnREYXRlLCBtaW4pO1xuICAgIH1cblxuICAgIGdldFllYXJzKGRhdGU6IERhdGUsIGN1cnJlbnREYXRlOiBEYXRlLCBtaW4/OiBEYXRlKTogSUNhbGVuZGFyIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBzdWJZZWFycyhkYXRlLCAxMCk7XG4gICAgICAgIGNvbnN0IGVuZCA9IGFkZFllYXJzKGRhdGUsIDkpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGF0ZVJlZjogZGF0ZSxcbiAgICAgICAgICAgIGRhdGVzOiBlYWNoWWVhck9mSW50ZXJ2YWwoe3N0YXJ0LCBlbmR9KS5tYXAoZCA9PiBuZXcgQ2FsZW5kYXJEYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRlOiBkLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBgJHtkLmdldEZ1bGxZZWFyKCl9YCxcbiAgICAgICAgICAgICAgICBpc0Z1dHVyZTogaXNGdXR1cmUoZCksXG4gICAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzU2FtZVllYXIoZCwgY3VycmVudERhdGUpLFxuICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQ6ICEhbWluICYmICFpc1NhbWVZZWFyKGQsIG1pbikgJiYgaXNCZWZvcmUoZCwgbWluKSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgIGhlYWRlckJ1dHRvbnM6IFt7bGFiZWw6IGAke3N0YXJ0LmdldEZ1bGxZZWFyKCl9IC0gJHtlbmQuZ2V0RnVsbFllYXIoKX1gLCB2aWV3OiBDYWxlbmRhclZpZXcuZGF5fV0sXG4gICAgICAgIH07XG4gICAgfVxufVxuIl19