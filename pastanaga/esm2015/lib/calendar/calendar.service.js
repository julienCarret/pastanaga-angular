import { __decorate, __metadata } from "tslib";
import { Injectable } from '@angular/core';
import { addMonths, addYears, eachDayOfInterval, eachMonthOfInterval, eachYearOfInterval, endOfMonth, endOfWeek, endOfYear, format, isBefore, isFuture, isSameDay, isSameMonth, isSameYear, isSaturday, isSunday, isWithinInterval, startOfMonth, startOfWeek, startOfYear, subMonths, subYears } from 'date-fns';
import { CalendarDate, CalendarView } from './calendar.model';
import * as i0 from "@angular/core";
let CalendarService = class CalendarService {
    constructor() {
    }
    getNextMonth(date, selectedRange, min) {
        const nextDate = addMonths(date, 1);
        return this.getMonth(nextDate, selectedRange, min);
    }
    getPreviousMonth(date, selectedRange, min) {
        const previousDate = subMonths(date, 1);
        return this.getMonth(previousDate, selectedRange, min);
    }
    getMonth(date, selectedRange, min) {
        let start = startOfMonth(date);
        let end = endOfMonth(date);
        const dateRef = start;
        if (!isSunday(start)) {
            start = startOfWeek(start);
        }
        if (!isSaturday(end)) {
            end = endOfWeek(end);
        }
        return {
            dateRef,
            dates: eachDayOfInterval({ start, end }).map(d => new CalendarDate({
                date: d,
                label: `${d.getDate()}`,
                isFuture: isFuture(d),
                firstOfInterval: !!selectedRange.start && isSameDay(d, selectedRange.start),
                lastOfInterval: !!selectedRange.end && isSameDay(d, selectedRange.end),
                inInterval: !!selectedRange.start && !!selectedRange.end
                    && isWithinInterval(d, { start: selectedRange.start, end: selectedRange.end }),
                isActive: (!!selectedRange.start && isSameDay(d, selectedRange.start))
                    || (!!selectedRange.end && isSameDay(d, selectedRange.end)),
                isDisabled: !!min && isBefore(d, min),
            })),
            headerButtons: [
                { label: format(date, 'MMMM'), view: CalendarView.month },
                { label: format(date, 'yyyy'), view: CalendarView.year },
            ],
        };
    }
    getPreviousMonths(date, currentDate, min) {
        const previousDate = subYears(date, 1);
        return this.getMonths(previousDate, currentDate, min);
    }
    getNextMonths(date, currentDate, min) {
        const nextDate = addYears(date, 1);
        return this.getMonths(nextDate, currentDate, min);
    }
    getMonths(date, currentDate, min) {
        const start = startOfYear(date);
        const end = endOfYear(date);
        return {
            dateRef: start,
            dates: eachMonthOfInterval({ start, end }).map(d => new CalendarDate({
                date: d,
                label: format(d, 'MMMM'),
                isFuture: isFuture(d),
                isActive: isSameMonth(d, currentDate),
                isDisabled: !!min && !isSameMonth(d, min) && isBefore(d, min),
            })),
            headerButtons: [{ label: format(date, 'yyyy'), view: CalendarView.year }],
        };
    }
    getPreviousYears(date, currentDate, min) {
        const previousDate = subYears(date, 20);
        return this.getYears(previousDate, currentDate, min);
    }
    getNextYears(date, currentDate, min) {
        const nextDate = addYears(date, 20);
        return this.getYears(nextDate, currentDate, min);
    }
    getYears(date, currentDate, min) {
        const start = subYears(date, 10);
        const end = addYears(date, 9);
        return {
            dateRef: date,
            dates: eachYearOfInterval({ start, end }).map(d => new CalendarDate({
                date: d,
                label: `${d.getFullYear()}`,
                isFuture: isFuture(d),
                isActive: isSameYear(d, currentDate),
                isDisabled: !!min && !isSameYear(d, min) && isBefore(d, min),
            })),
            headerButtons: [{ label: `${start.getFullYear()} - ${end.getFullYear()}`, view: CalendarView.day }],
        };
    }
};
CalendarService.ɵprov = i0.ɵɵdefineInjectable({ factory: function CalendarService_Factory() { return new CalendarService(); }, token: CalendarService, providedIn: "root" });
CalendarService = __decorate([
    Injectable({ providedIn: 'root' }),
    __metadata("design:paramtypes", [])
], CalendarService);
export { CalendarService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BndWlsbG90aW5hd2ViL3Bhc3RhbmFnYS1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL2NhbGVuZGFyL2NhbGVuZGFyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUNILFNBQVMsRUFDVCxRQUFRLEVBQ1IsaUJBQWlCLEVBQ2pCLG1CQUFtQixFQUNuQixrQkFBa0IsRUFDbEIsVUFBVSxFQUNWLFNBQVMsRUFDVCxTQUFTLEVBQ1QsTUFBTSxFQUNOLFFBQVEsRUFDUixRQUFRLEVBQ1IsU0FBUyxFQUNULFdBQVcsRUFDWCxVQUFVLEVBQ1YsVUFBVSxFQUNWLFFBQVEsRUFDUixnQkFBZ0IsRUFDaEIsWUFBWSxFQUNaLFdBQVcsRUFDWCxXQUFXLEVBQ1gsU0FBUyxFQUNULFFBQVEsRUFDWCxNQUFNLFVBQVUsQ0FBQztBQUNsQixPQUFPLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBYSxNQUFNLGtCQUFrQixDQUFDOztBQUd6RSxJQUFhLGVBQWUsR0FBNUIsTUFBYSxlQUFlO0lBQ3hCO0lBQ0EsQ0FBQztJQUVELFlBQVksQ0FBQyxJQUFVLEVBQUUsYUFBMkMsRUFBRSxHQUFVO1FBQzVFLE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDcEMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxhQUFhLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELGdCQUFnQixDQUFDLElBQVUsRUFBRSxhQUEyQyxFQUFFLEdBQVU7UUFDaEYsTUFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN4QyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLGFBQWEsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUMzRCxDQUFDO0lBRUQsUUFBUSxDQUFDLElBQVUsRUFBRSxhQUEyQyxFQUFFLEdBQVU7UUFDeEUsSUFBSSxLQUFLLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9CLElBQUksR0FBRyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNsQixLQUFLLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzlCO1FBQ0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNsQixHQUFHLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3hCO1FBQ0QsT0FBTztZQUNILE9BQU87WUFDUCxLQUFLLEVBQUUsaUJBQWlCLENBQUMsRUFBQyxLQUFLLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLFlBQVksQ0FBQztnQkFDN0QsSUFBSSxFQUFFLENBQUM7Z0JBQ1AsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFO2dCQUN2QixRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDckIsZUFBZSxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsS0FBSyxJQUFJLFNBQVMsQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLEtBQUssQ0FBQztnQkFDM0UsY0FBYyxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLEdBQUcsQ0FBQztnQkFDdEUsVUFBVSxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsR0FBRzt1QkFDakQsZ0JBQWdCLENBQUMsQ0FBQyxFQUFFLEVBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLGFBQWEsQ0FBQyxHQUFHLEVBQUMsQ0FBQztnQkFDaEYsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxLQUFLLElBQUksU0FBUyxDQUFDLENBQUMsRUFBRSxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7dUJBQy9ELENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxHQUFHLElBQUksU0FBUyxDQUFDLENBQUMsRUFBRSxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQy9ELFVBQVUsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDO2FBQ3hDLENBQUMsQ0FBQztZQUNILGFBQWEsRUFBRTtnQkFDWCxFQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxZQUFZLENBQUMsS0FBSyxFQUFDO2dCQUN2RCxFQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxZQUFZLENBQUMsSUFBSSxFQUFDO2FBQ3pEO1NBQ0osQ0FBQztJQUNOLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxJQUFVLEVBQUUsV0FBaUIsRUFBRSxHQUFVO1FBQ3ZELE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdkMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxXQUFXLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVELGFBQWEsQ0FBQyxJQUFVLEVBQUUsV0FBaUIsRUFBRSxHQUFVO1FBQ25ELE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbkMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxXQUFXLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVELFNBQVMsQ0FBQyxJQUFVLEVBQUUsV0FBaUIsRUFBRSxHQUFVO1FBQy9DLE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxNQUFNLEdBQUcsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUIsT0FBTztZQUNILE9BQU8sRUFBRSxLQUFLO1lBQ2QsS0FBSyxFQUFFLG1CQUFtQixDQUFDLEVBQUMsS0FBSyxFQUFFLEdBQUcsRUFBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxZQUFZLENBQUM7Z0JBQy9ELElBQUksRUFBRSxDQUFDO2dCQUNQLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQztnQkFDeEIsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLFFBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQztnQkFDckMsVUFBVSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDO2FBQ2hFLENBQUMsQ0FBQztZQUNILGFBQWEsRUFBRSxDQUFDLEVBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksQ0FBQyxJQUFJLEVBQUMsQ0FBQztTQUMxRSxDQUFDO0lBQ04sQ0FBQztJQUVELGdCQUFnQixDQUFDLElBQVUsRUFBRSxXQUFpQixFQUFFLEdBQVU7UUFDdEQsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN4QyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRUQsWUFBWSxDQUFDLElBQVUsRUFBRSxXQUFpQixFQUFFLEdBQVU7UUFDbEQsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNwQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsUUFBUSxDQUFDLElBQVUsRUFBRSxXQUFpQixFQUFFLEdBQVU7UUFDOUMsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQyxNQUFNLEdBQUcsR0FBRyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzlCLE9BQU87WUFDSCxPQUFPLEVBQUUsSUFBSTtZQUNiLEtBQUssRUFBRSxrQkFBa0IsQ0FBQyxFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksWUFBWSxDQUFDO2dCQUM5RCxJQUFJLEVBQUUsQ0FBQztnQkFDUCxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUU7Z0JBQzNCLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixRQUFRLEVBQUUsVUFBVSxDQUFDLENBQUMsRUFBRSxXQUFXLENBQUM7Z0JBQ3BDLFVBQVUsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsSUFBSSxRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQzthQUMvRCxDQUFDLENBQUM7WUFDSCxhQUFhLEVBQUUsQ0FBQyxFQUFDLEtBQUssRUFBRSxHQUFHLEtBQUssQ0FBQyxXQUFXLEVBQUUsTUFBTSxHQUFHLENBQUMsV0FBVyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsWUFBWSxDQUFDLEdBQUcsRUFBQyxDQUFDO1NBQ3BHLENBQUM7SUFDTixDQUFDO0NBQ0osQ0FBQTs7QUFoR1ksZUFBZTtJQUQzQixVQUFVLENBQUMsRUFBQyxVQUFVLEVBQUUsTUFBTSxFQUFDLENBQUM7O0dBQ3BCLGVBQWUsQ0FnRzNCO1NBaEdZLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICAgIGFkZE1vbnRocyxcbiAgICBhZGRZZWFycyxcbiAgICBlYWNoRGF5T2ZJbnRlcnZhbCxcbiAgICBlYWNoTW9udGhPZkludGVydmFsLFxuICAgIGVhY2hZZWFyT2ZJbnRlcnZhbCxcbiAgICBlbmRPZk1vbnRoLFxuICAgIGVuZE9mV2VlayxcbiAgICBlbmRPZlllYXIsXG4gICAgZm9ybWF0LFxuICAgIGlzQmVmb3JlLFxuICAgIGlzRnV0dXJlLFxuICAgIGlzU2FtZURheSxcbiAgICBpc1NhbWVNb250aCxcbiAgICBpc1NhbWVZZWFyLFxuICAgIGlzU2F0dXJkYXksXG4gICAgaXNTdW5kYXksXG4gICAgaXNXaXRoaW5JbnRlcnZhbCxcbiAgICBzdGFydE9mTW9udGgsXG4gICAgc3RhcnRPZldlZWssXG4gICAgc3RhcnRPZlllYXIsXG4gICAgc3ViTW9udGhzLFxuICAgIHN1YlllYXJzXG59IGZyb20gJ2RhdGUtZm5zJztcbmltcG9ydCB7IENhbGVuZGFyRGF0ZSwgQ2FsZW5kYXJWaWV3LCBJQ2FsZW5kYXIgfSBmcm9tICcuL2NhbGVuZGFyLm1vZGVsJztcblxuQEluamVjdGFibGUoe3Byb3ZpZGVkSW46ICdyb290J30pXG5leHBvcnQgY2xhc3MgQ2FsZW5kYXJTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICB9XG5cbiAgICBnZXROZXh0TW9udGgoZGF0ZTogRGF0ZSwgc2VsZWN0ZWRSYW5nZTogeyBzdGFydD86IERhdGUsIGVuZD86IERhdGUgfSwgbWluPzogRGF0ZSk6IElDYWxlbmRhciB7XG4gICAgICAgIGNvbnN0IG5leHREYXRlID0gYWRkTW9udGhzKGRhdGUsIDEpO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNb250aChuZXh0RGF0ZSwgc2VsZWN0ZWRSYW5nZSwgbWluKTtcbiAgICB9XG5cbiAgICBnZXRQcmV2aW91c01vbnRoKGRhdGU6IERhdGUsIHNlbGVjdGVkUmFuZ2U6IHsgc3RhcnQ/OiBEYXRlLCBlbmQ/OiBEYXRlIH0sIG1pbj86IERhdGUpOiBJQ2FsZW5kYXIge1xuICAgICAgICBjb25zdCBwcmV2aW91c0RhdGUgPSBzdWJNb250aHMoZGF0ZSwgMSk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE1vbnRoKHByZXZpb3VzRGF0ZSwgc2VsZWN0ZWRSYW5nZSwgbWluKTtcbiAgICB9XG5cbiAgICBnZXRNb250aChkYXRlOiBEYXRlLCBzZWxlY3RlZFJhbmdlOiB7IHN0YXJ0PzogRGF0ZSwgZW5kPzogRGF0ZSB9LCBtaW4/OiBEYXRlKTogSUNhbGVuZGFyIHtcbiAgICAgICAgbGV0IHN0YXJ0ID0gc3RhcnRPZk1vbnRoKGRhdGUpO1xuICAgICAgICBsZXQgZW5kID0gZW5kT2ZNb250aChkYXRlKTtcbiAgICAgICAgY29uc3QgZGF0ZVJlZiA9IHN0YXJ0O1xuICAgICAgICBpZiAoIWlzU3VuZGF5KHN0YXJ0KSkge1xuICAgICAgICAgICAgc3RhcnQgPSBzdGFydE9mV2VlayhzdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1NhdHVyZGF5KGVuZCkpIHtcbiAgICAgICAgICAgIGVuZCA9IGVuZE9mV2VlayhlbmQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkYXRlUmVmLFxuICAgICAgICAgICAgZGF0ZXM6IGVhY2hEYXlPZkludGVydmFsKHtzdGFydCwgZW5kfSkubWFwKGQgPT4gbmV3IENhbGVuZGFyRGF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0ZTogZCxcbiAgICAgICAgICAgICAgICBsYWJlbDogYCR7ZC5nZXREYXRlKCl9YCxcbiAgICAgICAgICAgICAgICBpc0Z1dHVyZTogaXNGdXR1cmUoZCksXG4gICAgICAgICAgICAgICAgZmlyc3RPZkludGVydmFsOiAhIXNlbGVjdGVkUmFuZ2Uuc3RhcnQgJiYgaXNTYW1lRGF5KGQsIHNlbGVjdGVkUmFuZ2Uuc3RhcnQpLFxuICAgICAgICAgICAgICAgIGxhc3RPZkludGVydmFsOiAhIXNlbGVjdGVkUmFuZ2UuZW5kICYmIGlzU2FtZURheShkLCBzZWxlY3RlZFJhbmdlLmVuZCksXG4gICAgICAgICAgICAgICAgaW5JbnRlcnZhbDogISFzZWxlY3RlZFJhbmdlLnN0YXJ0ICYmICEhc2VsZWN0ZWRSYW5nZS5lbmRcbiAgICAgICAgICAgICAgICAgICAgJiYgaXNXaXRoaW5JbnRlcnZhbChkLCB7c3RhcnQ6IHNlbGVjdGVkUmFuZ2Uuc3RhcnQsIGVuZDogc2VsZWN0ZWRSYW5nZS5lbmR9KSxcbiAgICAgICAgICAgICAgICBpc0FjdGl2ZTogKCEhc2VsZWN0ZWRSYW5nZS5zdGFydCAmJiBpc1NhbWVEYXkoZCwgc2VsZWN0ZWRSYW5nZS5zdGFydCkpXG4gICAgICAgICAgICAgICAgICAgIHx8ICghIXNlbGVjdGVkUmFuZ2UuZW5kICYmIGlzU2FtZURheShkLCBzZWxlY3RlZFJhbmdlLmVuZCkpLFxuICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQ6ICEhbWluICYmIGlzQmVmb3JlKGQsIG1pbiksXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgICBoZWFkZXJCdXR0b25zOiBbXG4gICAgICAgICAgICAgICAge2xhYmVsOiBmb3JtYXQoZGF0ZSwgJ01NTU0nKSwgdmlldzogQ2FsZW5kYXJWaWV3Lm1vbnRofSxcbiAgICAgICAgICAgICAgICB7bGFiZWw6IGZvcm1hdChkYXRlLCAneXl5eScpLCB2aWV3OiBDYWxlbmRhclZpZXcueWVhcn0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGdldFByZXZpb3VzTW9udGhzKGRhdGU6IERhdGUsIGN1cnJlbnREYXRlOiBEYXRlLCBtaW4/OiBEYXRlKTogSUNhbGVuZGFyIHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNEYXRlID0gc3ViWWVhcnMoZGF0ZSwgMSk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE1vbnRocyhwcmV2aW91c0RhdGUsIGN1cnJlbnREYXRlLCBtaW4pO1xuICAgIH1cblxuICAgIGdldE5leHRNb250aHMoZGF0ZTogRGF0ZSwgY3VycmVudERhdGU6IERhdGUsIG1pbj86IERhdGUpOiBJQ2FsZW5kYXIge1xuICAgICAgICBjb25zdCBuZXh0RGF0ZSA9IGFkZFllYXJzKGRhdGUsIDEpO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNb250aHMobmV4dERhdGUsIGN1cnJlbnREYXRlLCBtaW4pO1xuICAgIH1cblxuICAgIGdldE1vbnRocyhkYXRlOiBEYXRlLCBjdXJyZW50RGF0ZTogRGF0ZSwgbWluPzogRGF0ZSk6IElDYWxlbmRhciB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gc3RhcnRPZlllYXIoZGF0ZSk7XG4gICAgICAgIGNvbnN0IGVuZCA9IGVuZE9mWWVhcihkYXRlKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRhdGVSZWY6IHN0YXJ0LFxuICAgICAgICAgICAgZGF0ZXM6IGVhY2hNb250aE9mSW50ZXJ2YWwoe3N0YXJ0LCBlbmR9KS5tYXAoZCA9PiBuZXcgQ2FsZW5kYXJEYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRlOiBkLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBmb3JtYXQoZCwgJ01NTU0nKSxcbiAgICAgICAgICAgICAgICBpc0Z1dHVyZTogaXNGdXR1cmUoZCksXG4gICAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzU2FtZU1vbnRoKGQsIGN1cnJlbnREYXRlKSxcbiAgICAgICAgICAgICAgICBpc0Rpc2FibGVkOiAhIW1pbiAmJiAhaXNTYW1lTW9udGgoZCwgbWluKSAmJiBpc0JlZm9yZShkLCBtaW4pLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgaGVhZGVyQnV0dG9uczogW3tsYWJlbDogZm9ybWF0KGRhdGUsICd5eXl5JyksIHZpZXc6IENhbGVuZGFyVmlldy55ZWFyfV0sXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZ2V0UHJldmlvdXNZZWFycyhkYXRlOiBEYXRlLCBjdXJyZW50RGF0ZTogRGF0ZSwgbWluPzogRGF0ZSk6IElDYWxlbmRhciB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzRGF0ZSA9IHN1YlllYXJzKGRhdGUsIDIwKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0WWVhcnMocHJldmlvdXNEYXRlLCBjdXJyZW50RGF0ZSwgbWluKTtcbiAgICB9XG5cbiAgICBnZXROZXh0WWVhcnMoZGF0ZTogRGF0ZSwgY3VycmVudERhdGU6IERhdGUsIG1pbj86IERhdGUpOiBJQ2FsZW5kYXIge1xuICAgICAgICBjb25zdCBuZXh0RGF0ZSA9IGFkZFllYXJzKGRhdGUsIDIwKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0WWVhcnMobmV4dERhdGUsIGN1cnJlbnREYXRlLCBtaW4pO1xuICAgIH1cblxuICAgIGdldFllYXJzKGRhdGU6IERhdGUsIGN1cnJlbnREYXRlOiBEYXRlLCBtaW4/OiBEYXRlKTogSUNhbGVuZGFyIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBzdWJZZWFycyhkYXRlLCAxMCk7XG4gICAgICAgIGNvbnN0IGVuZCA9IGFkZFllYXJzKGRhdGUsIDkpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGF0ZVJlZjogZGF0ZSxcbiAgICAgICAgICAgIGRhdGVzOiBlYWNoWWVhck9mSW50ZXJ2YWwoe3N0YXJ0LCBlbmR9KS5tYXAoZCA9PiBuZXcgQ2FsZW5kYXJEYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRlOiBkLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBgJHtkLmdldEZ1bGxZZWFyKCl9YCxcbiAgICAgICAgICAgICAgICBpc0Z1dHVyZTogaXNGdXR1cmUoZCksXG4gICAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzU2FtZVllYXIoZCwgY3VycmVudERhdGUpLFxuICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQ6ICEhbWluICYmICFpc1NhbWVZZWFyKGQsIG1pbikgJiYgaXNCZWZvcmUoZCwgbWluKSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgIGhlYWRlckJ1dHRvbnM6IFt7bGFiZWw6IGAke3N0YXJ0LmdldEZ1bGxZZWFyKCl9IC0gJHtlbmQuZ2V0RnVsbFllYXIoKX1gLCB2aWV3OiBDYWxlbmRhclZpZXcuZGF5fV0sXG4gICAgICAgIH07XG4gICAgfVxufVxuIl19