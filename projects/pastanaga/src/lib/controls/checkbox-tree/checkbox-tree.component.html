<fieldset class="pa-fieldset-group" [id]="id">
    <legend [class.pa-sr]="_isChildren" [class.pa-select-all]="_selectAllVisible">
        <ng-content></ng-content>
        <pa-badge *ngIf="_countVisible" [isSmall]="true" [isAccented]="true"
                  [value]="totalSelected" [of]="totalCount"></pa-badge>
    </legend>

    <ng-container *ngIf="type === 'checkbox'">
        <pa-button *ngIf="!_isChildren && _selectAllVisible"
                   size="small" class="pa-field-button-right"
                   id="checkbox-tree-select-all"
                   [color]="isAllSelected ? 'secondary' : 'primary'"
                   (click)="toggleSelectAll()">
            {{isAllSelected ? 'common.deselect-all' : 'common.select-all'}}
        </pa-button>

        <div class="pa-field-group" *ngFor="let checkbox of _checkboxes">
            <pa-button *ngIf="(!!checkbox.children && checkbox.children.length > 0) || (!checkbox.children && isAsync)"
                       color="secondary" size="small"
                       id="pa-expand-checkbox-{{checkbox.id}}"
                       [icon]="!checkbox.children ? 'initiating' : 'right-key'"
                       [disabled]="!checkbox.children"
                       ariaControls="pa-expand-checkbox-{{checkbox.id}}"
                       [ariaExpanded]="checkbox.isExpanded"
                       (click)="toggleCheckbox(checkbox)">
                {{!checkbox.children ? 'Loading' : !checkbox.isExpanded ? 'Expand' : 'Collapse'}}
            </pa-button>
            <pa-checkbox [id]="checkbox.id"
                         [icon]="checkbox.icon"
                         [help]="checkbox.help"
                         [selected]="checkbox.isSelected"
                         [disabled]="checkbox.isDisabled"
                         [indeterminate]="checkbox.isIndeterminate"
                         [squareCheck]="mode === modes.fileSystem"
                         [badgeVisible]="_badgeVisible && !!checkbox.children && checkbox.children.length > 0"
                         [totalChildren]="checkbox.totalChildren"
                         [selectedChildren]="checkbox.selectedChildren"
                         (selection)="toggleSelection($event, checkbox)">{{checkbox.label}}
            </pa-checkbox>

            <div class="pa-field-sublist" role="tabpanel"
                 [attr.aria-labelledby]="'pa-expand-checkbox-' + checkbox.id"
                 [attr.aria-hidden]="!checkbox.isExpanded">
                <pa-checkbox-tree *ngIf="checkbox.isExpanded" isChildren
                                  [doLoadChildren]="checkbox.isExpanded"
                                  [checkboxes]="checkbox.children"
                                  [getChildren]="_getChildren"
                                  [mode]="mode"
                                  (updatedTree)="setParentState($event, checkbox)"></pa-checkbox-tree>
            </div>
        </div>
    </ng-container>

    <div class="pa-field-group" *ngIf="type === 'radio'">
        <pa-checkbox *ngFor="let checkbox of _checkboxes"
                     [icon]="checkbox.icon"
                     type="radio"
                     [help]="checkbox.help"
                     [disabled]="checkbox.isDisabled"
                     [badgeVisible]="_badgeVisible && !!checkbox.children && checkbox.children.length > 0"
                     [(selected)]="checkbox.isSelected"
                     (selection)="toggleRadioSelection(checkbox.value)">{{checkbox.label}}
        </pa-checkbox>
    </div>
</fieldset>

